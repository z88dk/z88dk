#

include ../../../Make.config

vpath %.c ../../_DEVELOPMENT/math/float/am9511/c
vpath %.c ../cimpl


CFILES  = $(notdir $(wildcard $(NEWLIB_DIRECTORY)/math/float/am9511/c/*.c)) atof.c ftoa.c ftoe.c
CFILES  = atof.c ftoa.c ftoe.c fromfix16.c tofix16.c
AFILES = 
OBJECTS = $(CFILES:.c=.o) $(AFILES:.asm=.o)

CFLAGS += -fp-mode=ieee

all: dirs $(OUTPUT_DIRECTORY)/am9511.lib $(OUTPUT_DIRECTORY)/am9511_ixiy.lib $(OUTPUT_DIRECTORY)/am9511_8085.lib \
	$(OUTPUT_DIRECTORY)/am9511_z180.lib \
	$(OUTPUT_DIRECTORY)/am9511h.lib

$(OUTPUT_DIRECTORY)/am9511.lib: $(addprefix obj/z80/, $(OBJECTS))
	$(Q)$(ASSEMBLER) -d -I$(Z88DK_LIB) -O=obj/z80/x/x/x  -I.. -mz80 -D__CLASSIC @newlibfiles_z80.lst
	TYPE=z80 $(LIBLINKER) -x$(OUTPUT_DIRECTORY)/am9511 @am9511.lst

$(OUTPUT_DIRECTORY)/am9511_ixiy.lib: $(addprefix obj/ixiy/, $(OBJECTS))
	$(Q)$(ASSEMBLER) -d -I$(Z88DK_LIB) -O=obj/ixiy/x/x/x -I.. -IXIY -mz80 -D__CLASSIC @newlibfiles_z80.lst
	TYPE=ixiy $(LIBLINKER) -IXIY -x$(OUTPUT_DIRECTORY)/am9511_ixiy @am9511.lst

$(OUTPUT_DIRECTORY)/am9511_z180.lib: $(addprefix obj/z180/, $(OBJECTS))
	$(Q)$(ASSEMBLER) -d -I$(Z88DK_LIB) -O=obj/z180/x/x/x -I.. -mz180 -D__CLASSIC @newlibfiles_z80.lst
	TYPE=z180 $(LIBLINKER) -mz180 -x$(OUTPUT_DIRECTORY)/am9511_z180 @am9511.lst

$(OUTPUT_DIRECTORY)/am9511_8085.lib: $(addprefix obj/8085/, $(OBJECTS))
	$(Q)$(ASSEMBLER) -d -I$(Z88DK_LIB) -O=obj/8085/x/x/x -I.. -m8085 -D__CLASSIC @newlibfiles_8085.lst
	TYPE=8085 $(LIBLINKER) -m8085 -x$(OUTPUT_DIRECTORY)/am9511_8085 @am9511.lst

$(OUTPUT_DIRECTORY)/am9511h.lib: $(addprefix obj/z80h/, $(OBJECTS))
	$(Q)$(ASSEMBLER) -d -I$(Z88DK_LIB) -O=obj/z80h/x/x/x  -I.. -mz80 -D__CLASSIC -D__AM9511_HELPER_FUNC @newlibfiles_z80h.lst
	TYPE=z80h $(LIBLINKER) -mz80 -x$(OUTPUT_DIRECTORY)/am9511h @am9511.lst


obj/z80h/%.o: %.c
	$(ZCC) +test -mz80 $(CFLAGS) -o $@  $^


dirs:
	@mkdir -p obj/z80/c obj/ixiy/c  obj/8085/c obj/z180 obj/z80h obj/8080

clean:
	$(RM) *.o* *.sym *.map *.err zcc_opt.def *.i *.opt config_private.inc
	$(RM) -fr obj

