Extracted from: https://github.com/ivagorRetrocomp/DeZX

Following changes made:

* Changing #ifdef syntax
* Manually expanded the #defines
* Unfolding the single line expressions
